<?phpclass Admin_GaleriasController extends Zend_Controller_Action {    public function init() {        $this->view->controller = $this->_request->getControllerName();        parent::init();    }    public function indexAction() {        $ModelGalerias = new Admin_Model_Galerias();        $dados = $ModelGalerias->Lista();        $this->view->dados = $dados;    }    public function adicionarAction() {        $form = new TCS_Form_FormGaleria();        $ModelEventos = new Admin_Model_Galerias();        $data = $this->_request->getPost();        if ($this->_request->isPost() && $form->isValid($data)) {            $ModelEventos->insert($data);            //Adiciona a mensagem de sucesso            $this->_helper->FlashMessenger->addMessage(array('sucesso' => 'Adicionado com sucesso'));            $this->redirect('admin/galerias/');        }        $this->view->form = $form;    }    public function editarAction() {        $id = $this->_request->getParam('id');        $form = new TCS_Form_FormGaleria();        $ModelEventos = new Admin_Model_Galerias();        $data = $this->_request->getPost();        if ($id) {            $values = $ModelEventos->GetDados($id);            $form->populate($values);            if ($this->_request->isPost()) {                $ModelEventos->insert($data);                $this->_helper->FlashMessenger->addMessage(array('sucesso' => 'Editado com sucesso'));                $this->_helper->redirector('index');            }            $this->view->form = $form;            $this->render('adicionar');        } else {            $this->_helper->redirector('index');        }    }    public function excluirAction() {        $id = $this->_request->getParam('id');        $ModelEventos = new Admin_Model_Galerias();        $ModeImagens = new Admin_Model_GaleriaImagens();        $result = $ModeImagens->BuscarImagens($id);        if ($result) {            foreach ($result as $evn) {                $caminho = 'imagens/galerias/' . $evn['imagem'];                if (file_exists($caminho)) {                    unlink($caminho);                }            }        }        $ModeImagens->delete("galeria = " . $id);        $ModelEventos->delete("id = " . $id);        //Adiciona a mensagem de sucesso        $this->_helper->FlashMessenger->addMessage(array('sucesso' => 'Excluido com sucesso'));        $this->_redirect('admin/galerias');    }    public function ajaxImagensAction() {        $param = $this->_request->getParam('param');        $ModelImagens = new Admin_Model_GaleriaImagens();        $data = $ModelImagens->BuscarImagens($param);        $this->_helper->json($data);    }    public function ajaxDeletaImagemAction() {        $param = $this->_request->getParam('param');        $ModelImagens = new Admin_Model_GaleriaImagens();        $data = $ModelImagens->BuscarImagem($param);        $caminho = 'imagens/galerias/' . $data['imagem'];        $ModelImagens->ApagaIMG("id = '$param'", $caminho);        $this->_helper->json('1');    }    public function ajaxSetaCapaAction() {        $param = $this->_request->getParam('param');        $ModelImagens = new Admin_Model_GaleriaImagens();        $data = $ModelImagens->BuscarImagem($param);        $ModelImagens->update(array("capa" => 0), "galeria = " . $data['galeria']);        $ModelImagens->update(array("capa" => 1), "imagem = '$param'");        $this->_helper->json('1');    }    public function ajaxSetaOrderAction() {        $param = $this->_request->getParam('param');        $ModelImagens = new Admin_Model_GaleriaImagens();        foreach ($param as $key => $img)            if ($key > 0) {                $ModelImagens->update(array("ordem" => $key), "imagem = '$img'");            }        $this->_helper->json('1');    }}