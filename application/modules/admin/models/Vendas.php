<?phpclass Admin_Model_Vendas extends Zend_Db_Table {    protected $_name = 'vendas';    protected $_primary = 'id';    protected $imagens = '';    public function init() {        $viewRenderer = Zend_Controller_Action_HelperBroker::getStaticHelper('ViewRenderer');        $viewRenderer->init();        $this->view = $viewRenderer->view;    }    public function Dados() {        if ($retun = $this->fetchRow()) {            return $retun->toArray();        }    }    public function GetId($id) {        $sql = $this->select()                ->setIntegrityCheck(false)                ->from(array('u' => $this->_name), array("*"))                ->joinLeft(array("i" => "venda_imagens"), "i.venda = u.id", array("imagem" => "i.imagem"))                ->where("u.id = ? ", $id);        if ($data = $this->fetchRow($sql)) {            return $data->toArray();        } else {            return false;        }    }    public function GetVenda($id) {        $sql = $this->select()                ->setIntegrityCheck(false)                ->from(array('v' => $this->_name), array("*"))                ->where("v.id = ? ", $id);        if ($data = $this->fetchRow($sql)) {            $ModelImagens = new Admin_Model_VendaImagens();            $result = $data->toArray();            $result['imagens'] = $ModelImagens->BuscarImagens($id);            return $result;        } else {            return false;        }    }    public function Lista($limit = '', $destaque = NULL, $ativo = false) {        $sql = $this->select()                ->setIntegrityCheck(false)                ->from(array('v' => $this->_name), array("*"))                ->joinLeft(array("i" => "venda_imagens"), "i.venda = v.id and (i.capa = 1)", array("imagem" => "i.imagem"))                ->order("id DESC")                ->group('v.id');        if ($limit) {            $sql->limit($limit);        }        if ($destaque) {            $sql->where("v.destaque = 1");        }                if ($ativo) {            $sql->where("v.ativo = 1");        }        if ($arr = $this->fetchAll($sql)) {            $vendas = $arr->toArray();            $imagem = new Admin_Model_VendaImagens();            foreach ($vendas as $key => $row) {                if (empty($row['imagem'])) {                    $vendas[$key]['imagem'] = $imagem->GetImg($row['id']);                }            }            return $vendas;        } else {            return false;        }    }    public function GetDados($id) {        $sql = $this->select()                ->where("id = ?", $id);        if ($data = $this->fetchRow($sql)) {            if (!empty($data['km_rodados'])) {                $data['km_rodados'] = $this->view->LimpaNumero($data['km_rodados']);            }            if (!empty($data['valor'])) {                $data['valor'] = $this->view->LimpaNumero($data['valor']);            }            return $data->toArray();        }    }    public function insert(array $data) {        $vinculo = $data['vinculo'];        if (!is_array($data))            return false;        if (empty($data['imagem'])) {            unset($data['imagem']);        }        if (is_numeric($data['id'])) {            $this->update($data, "id = " . $data['id']);            return $data['id'];        }        if (!empty($data['valor'])) {            $data['valor'] = $this->view->LimpaNumero($data['valor']);        }        if (!empty($data['km_rodados'])) {            $data['km_rodados'] = $this->view->LimpaNumero($data['km_rodados']);        }        unset($data['id']);        $data['data_cadastro'] = date('Y-m-d H:i:s');        $info = $this->info();        $data_insert = array_intersect_key($data, $info['metadata']);        $lastId = parent::insert($data_insert);        if ($vinculo != $lastId) {            $imagem = new Admin_Model_VendaImagens();            $imagem->update(array('venda' => $lastId), "venda = '" . $vinculo . "' ");        }        return $lastId;    }    public function update(array $data, $where) {        if (!empty($data['valor'])) {            $data['valor'] = $this->view->LimpaNumero($data['valor']);        }        if (!empty($data['km_rodados'])) {            $data['km_rodados'] = $this->view->LimpaNumero($data['km_rodados']);        }        $info = $this->info();        $data_insert = array_intersect_key($data, $info['metadata']);        return parent::update($data_insert, $where);        $vinculo = $data['vinculo'];        $imagem = new Admin_Model_VendaImagens();        $imagem->update(array('venda' => $data['id']), "venda = '" . $vinculo . "' ");    }    public function delete($where) {        return parent::delete($where);    }}